\documentclass[tikz,border=5pt]{standalone}
\usepackage{tikz}
\usetikzlibrary{positioning,shapes.geometric,arrows.meta,fit,calc}

\definecolor{inputcolor}{RGB}{240,240,240}
\definecolor{convcolor}{RGB}{232,245,232}
\definecolor{densecolor}{RGB}{227,242,253}
\definecolor{fusioncolor}{RGB}{255,243,224}
\definecolor{skipcolor}{RGB}{200,200,200}

\begin{document}
	\begin{tikzpicture}[
		% Layer styles
		input/.style={rectangle, rounded corners=3pt, minimum height=1cm, minimum width=2cm, 
			fill=inputcolor, draw=black, line width=0.5pt, text centered, font=\footnotesize},
		conv/.style={rectangle, rounded corners=3pt, minimum height=1cm, minimum width=1.8cm,
			fill=convcolor, draw=black, line width=0.5pt, text centered, font=\footnotesize},
		dense/.style={rectangle, rounded corners=3pt, minimum height=0.8cm, minimum width=1.5cm,
			fill=densecolor, draw=black, line width=0.5pt, text centered, font=\footnotesize},
		fusion/.style={rectangle, rounded corners=3pt, minimum height=1cm, minimum width=1.8cm,
			fill=fusioncolor, draw=black, line width=0.5pt, text centered, font=\footnotesize},
		output/.style={rectangle, rounded corners=3pt, minimum height=1cm, minimum width=1.5cm,
			fill=inputcolor, draw=black, line width=0.5pt, text centered, font=\footnotesize},
		pool/.style={rectangle, minimum height=0.3cm, minimum width=1.5cm,
			fill=skipcolor, draw=black, line width=0.5pt, text centered, font=\scriptsize},
		% Arrow styles
		arrow/.style={->, >=Stealth, thick, line width=1pt},
		fusionarrow/.style={->, >=Stealth, thick, line width=1pt, color=orange},
		skiparrow/.style={->, >=Stealth, thick, line width=1pt, dashed, color=blue},
		uparrow/.style={->, >=Stealth, thick, line width=1pt, color=purple},
		% Text styles
		dimlabel/.style={font=\scriptsize, text=gray},
		layerlabel/.style={font=\footnotesize}
		]
		
		% TTG Input Path (Top)
		\node[input] (ttg_input) at (0,8) {TTG Input};
		\node[dimlabel, below=2pt of ttg_input] {B×C₁×1024×1024};
		
		% TTG Encoder stages
		\node[conv] (enc1) at (2.5,8) {Encoder 1};
		\node[dimlabel, below=2pt of enc1] {B×64×1024×1024};
		\node[pool] (pool1) at (2.5,7.4) {MaxPool};
		
		\node[conv] (enc2) at (5,7.5) {Encoder 2};
		\node[dimlabel, below=2pt of enc2] {B×128×512×512};
		\node[pool] (pool2) at (5,6.9) {MaxPool};
		
		\node[conv] (enc3) at (7.5,7) {Encoder 3};
		\node[dimlabel, below=2pt of enc3] {B×256×256×256};
		\node[pool] (pool3) at (7.5,6.4) {MaxPool};
		
		% DCT Input Path (Bottom)
		\node[input] (dct_input) at (0,2) {DCT Input};
		\node[dimlabel, below=2pt of dct_input] {B×C₂×128×128};
		
		% DCT Processing (with 3D conv option)
		\node[conv] (dct_proc) at (2.5,2) {DCT\\Processor};
		\node[dimlabel, below=2pt of dct_proc] {B×64×128×128};
		
		% Fusion Point
		\node[fusion] (fusion_join) at (10,4.7) {Feature\\Fusion};
		\node[dimlabel, below=2pt of fusion_join] {B×320×128×128};
		
		\node[conv] (join_enc) at (12.5,4.7) {Join\\Encoder};
		\node[dimlabel, below=2pt of join_enc] {B×512×128×128};
		\node[pool] (pool4) at (12.5,4.1) {MaxPool};
		
		% Bottleneck
		\node[conv] (bottleneck) at (15,4.2) {Bottleneck};
		\node[dimlabel, below=2pt of bottleneck] {B×1024×64×64};
		
		% Decoder Path
		\node[conv] (dec4) at (17.5,5.2) {Decoder 4};
		\node[dimlabel, below=2pt of dec4] {B×512×128×128};
		
		\node[conv] (dec3) at (20,6.2) {Decoder 3};
		\node[dimlabel, below=2pt of dec3] {B×256×256×256};
		
		\node[conv] (dec2) at (22.5,7.2) {Decoder 2};
		\node[dimlabel, below=2pt of dec2] {B×128×512×512};
		
		\node[conv] (dec1) at (25,8.2) {Decoder 1};
		\node[dimlabel, below=2pt of dec1] {B×64×1024×1024};
		
		\node[output] (final_output) at (27.5,8.2) {Output};
		\node[dimlabel, below=2pt of final_output] {B×K×1024×1024};
		
		% Upsampling indicators
		\node[dense, minimum height=0.4cm, minimum width=0.8cm, fill=purple!30] (up4) at (16.2,4.7) {Up};
		\node[dense, minimum height=0.4cm, minimum width=0.8cm, fill=purple!30] (up3) at (18.7,5.7) {Up};
		\node[dense, minimum height=0.4cm, minimum width=0.8cm, fill=purple!30] (up2) at (21.2,6.7) {Up};
		\node[dense, minimum height=0.4cm, minimum width=0.8cm, fill=purple!30] (up1) at (23.7,7.7) {Up};
		
		% Main forward flow arrows
		\draw[arrow] (ttg_input) -- (enc1);
		\draw[arrow] (enc1) -- (enc2);
		\draw[arrow] (enc2) -- (enc3);
		\draw[arrow] (dct_input) -- (dct_proc);
		
		% Fusion arrows
		\draw[fusionarrow] (enc3.east) to[out=0,in=180] (fusion_join.west);
		\draw[fusionarrow] (dct_proc.east) to[out=0,in=180] (fusion_join.west);
		\draw[arrow] (fusion_join) -- (join_enc);
		\draw[arrow] (join_enc) -- (bottleneck);
		
		% Decoder path
		\draw[uparrow] (bottleneck) -- (up4);
		\draw[arrow] (up4) -- (dec4);
		\draw[uparrow] (dec4) -- (up3);
		\draw[arrow] (up3) -- (dec3);
		\draw[uparrow] (dec3) -- (up2);
		\draw[arrow] (up2) -- (dec2);
		\draw[uparrow] (dec2) -- (up1);
		\draw[arrow] (up1) -- (dec1);
		\draw[arrow] (dec1) -- (final_output);
		
		% Skip connections
		\draw[skiparrow] (join_enc.north) to[out=90,in=270] (dec4.south);
		\draw[skiparrow] (enc3.north) to[out=90,in=270] (dec3.south);
		\draw[skiparrow] (enc2.north) to[out=90,in=270] (dec2.south);
		\draw[skiparrow] (enc1.north) to[out=90,in=270] (dec1.south);
		
		% Conv3D option annotation
		\node[draw, dashed, rounded corners, fit={(0,1) (3.5,3)}, color=red, line width=0.8pt] {};
		\node[layerlabel, color=red] at (1.75,0.5) {Optional 3D Conv};
		
		% Activation and normalization indicators
		\foreach \x in {2.5,5,7.5,12.5,15,17.5,20,22.5,25} {
			\node[circle, fill=green!70, minimum size=2pt] at (\x,9.5) {};
		}
		\node[layerlabel, color=green!70] at (13.75,9.8) {BatchNorm + ReLU};
		
		% Size transitions
		\node[layerlabel, color=gray] at (6.25,9.2) {1024→512→256→128};
		\node[layerlabel, color=gray] at (20.75,9.2) {128→256→512→1024};
		
		% Multi-input architecture label
		\node[draw, rounded corners, fit={(0,0.2) (4,3.2)}, color=blue, line width=1pt] {};
		\node[layerlabel, color=blue] at (2,3.5) {Dual Input Processing};
		
		% Legend
		\node[draw, rounded corners, fit={(28,3) (33,7)}, fill=white] (legend) {};
		\node[layerlabel, above right=2pt of legend.north west] {Legend:};
		\node[input, minimum width=0.8cm, minimum height=0.5cm] at (28.6,6.4) {};
		\node[layerlabel, right=3pt] at (29.1,6.4) {Input/Output};
		\node[conv, minimum width=0.8cm, minimum height=0.5cm] at (28.6,6.0) {};
		\node[layerlabel, right=3pt] at (29.1,6.0) {Conv Block};
		\node[fusion, minimum width=0.8cm, minimum height=0.5cm] at (28.6,5.6) {};
		\node[layerlabel, right=3pt] at (29.1,5.6) {Fusion};
		\node[pool, minimum width=0.8cm, minimum height=0.3cm] at (28.6,5.2) {};
		\node[layerlabel, right=3pt] at (29.1,5.2) {Pool/Upsample};
		
		% Arrow legend
		\draw[arrow] (28.5,4.8) -- (29.3,4.8);
		\node[layerlabel, right=3pt] at (29.3,4.8) {Forward};
		\draw[skiparrow] (28.5,4.4) -- (29.3,4.4);
		\node[layerlabel, right=3pt] at (29.3,4.4) {Skip Connection};
		\draw[fusionarrow] (28.5,4.0) -- (29.3,4.0);
		\node[layerlabel, right=3pt] at (29.3,4.0) {Fusion Path};
		\draw[uparrow] (28.5,3.6) -- (29.3,3.6);
		\node[layerlabel, right=3pt] at (29.3,3.6) {Upsample};
		
		% Title
		\node[layerlabel, font=\normalsize] at (13.75,10.5) {SplitUNet: Dual-Input Segmentation Architecture};
		
		% Key parameters
		\node[layerlabel, font=\scriptsize, text=gray] at (13.75,0.5) {
			\begin{tabular}{c}
				Parameters: in\_channels (TTG), in\_dct\_channels (DCT), out\_channels (K classes), \\
				inner\_channels (64), use\_conv3d (optional), λ\_loss (BCE/Dice weighting)
		\end{tabular}};
		
		% Loss function annotation
		\node[output, minimum width=3cm] (loss_box) at (30,8.2) {Combined Loss\\BCE + Dice + Focal};
		\node[dimlabel, below=2pt of loss_box] {Class-weighted};
		\draw[arrow] (final_output) -- (loss_box);
		
	\end{tikzpicture}
\end{document}